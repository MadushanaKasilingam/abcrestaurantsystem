<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600&display=swap');

        :root {
            --green: #27ae60;
            --black: #333;
            --white: #fff;
            --bg-color: #eee;
            --box-shadow: 0 .8rem 1rem rgba(0, 0, 0, .1);
            --border: .1rem solid var(--black);
        }

        * {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            outline: none;
            border: none;
            text-decoration: none;
            text-transform: capitalize;
        }

        html {
            font-size: 62.5%;
            overflow-x: hidden;
        }

        body {
            background-color: var(--bg-color);
        }

        .container {
            max-width: 1200px;
            padding: 2rem;
            margin: 2rem auto;
           
            background-color: var(--white);
            box-shadow: var(--box-shadow);
            border-radius: .5rem;

        }

        h1 {
            text-align: center;
            color: #3b141c;
            font-family: "Lobster", sans-serif;
            font-size: 45px;
            margin-bottom: 2rem;
        }

        .btn {
            display: block;
            width: 100%;
            cursor: pointer;
            border-radius: .5rem;
            margin-top: 1rem;
            font-size: 1.7rem;
            padding: 1rem 3rem;
            background: #f3961c;
            color: var(--white);
            text-align: center;
        }

        

        .message {
            display: block;
            background: var(--bg-color);
            padding: 1.5rem 1rem;
            font-size: 2rem;
            color: var(--black);
            margin-bottom: 2rem;
            text-align: center;
        }

        .staff-list {
            margin-top: 2rem;
        }

        .staff-item {
            display: flex;
            justify-content: space-between;
            background-color: var(--bg-color);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: .5rem;
            box-shadow: var(--box-shadow);
        }

        .staff-item h3 {
            margin: 0;
            font-size: 1.8rem;
            color: var(--black);
        }

        .staff-actions {
            display: flex;
            gap: 1rem;
        }

        .staff-actions .btn {
            background-color: #f0ad4e;
        }
        .staff-actions .btn:hover {
            background-color: #f3961c;
        }


        .staff-actions .btn-delete {
            background-color: #d9534f;
        }

        .staff-actions .btn-delete:hover {
            background-color: #c9302c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            padding: 2rem;
            border-radius: .5rem;
            width: 40rem;
        }

        .modal-content input {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: .5rem;
            font-size: 1.7rem;
        }

        .success-message {
            color: #3b141c;
            font-size: 1.6rem;
            margin-top: 2rem;
            text-align: center;
        }

        .error-message {
            color: #3b141c;
            font-size: 1.6rem;
            margin-top: 2rem;
            text-align: center;
        }

        .navbar {
            background-color: #3b141c;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--white);
        }

        .navbar .nav-left, .navbar .nav-right {
            display: flex;
            font-size: 18px;
            gap: 2rem;
        }

        .navbar a {
            color: var(--white);
            font-size: 1.6rem;
            text-decoration: none;
            cursor: pointer;
        }

        .navbar a:hover {
            text-decoration: underline;
        }


        @media (max-width: 991px) {
            html {
                font-size: 55%;
            }
        }

        @media (max-width: 768px) {
            .staff-list {
                overflow-y: scroll;
            }
        }

        @media (max-width: 450px) {
            html {
                font-size: 50%;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="nav-left">
            <span>Admin Panel</span>
        </div>
        <div class="nav-right">
            <a href="adminpanel.html">Home</a>
            <a id="logoutBtn" href="login.html">Logout</a>
        </div>
        
    </div>

    <div class="container">
        <h1>Staff Management</h1>

        <!-- Staff Management -->
        <button class="btn" id="addStaffBtn">Add Staff</button>
        <div id="message"></div>
        <div class="staff-list" id="staffList">
            <!-- Staff members will be loaded here dynamically -->
        </div>
    </div>

    <!-- Modal for Adding/Updating Staff -->
    <div class="modal" id="staffModal">
        <div class="modal-content">
            <h2 id="modalTitle">Add Staff</h2>
            <input type="text" id="staffUsername" placeholder="Username" required>
            <input type="email" id="staffEmail" placeholder="Email" required>
            <input type="password" id="staffPassword" placeholder="Password" required>
            <button class="btn" id="saveStaffBtn">Save</button>
        </div>
    </div>

    <script>
        const staffList = document.getElementById('staffList');
        const staffModal = document.getElementById('staffModal');
        const modalTitle = document.getElementById('modalTitle');
        const saveStaffBtn = document.getElementById('saveStaffBtn');
        const addStaffBtn = document.getElementById('addStaffBtn');
        const messageDiv = document.getElementById('message');
        const token = localStorage.getItem('jwt');

        const staffUsername = document.getElementById('staffUsername');
        const staffEmail = document.getElementById('staffEmail');
        const staffPassword = document.getElementById('staffPassword');

        let isUpdate = false;
        let currentStaffId = null;

        // Fetch and display all staff members
        async function loadStaffs() {
            try {
                const response = await fetch('http://localhost:5786/auth/getAllStaffs', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    const staffs = await response.json();
                    staffList.innerHTML = '';
                    staffs.forEach(staff => {
                        const staffItem = document.createElement('div');
                        staffItem.classList.add('staff-item');
                        staffItem.innerHTML = `
                            <h3>${staff.username}</h3>
                            <div class="staff-actions">
                                <button class="btn" onclick="editStaff(${staff.id})">Edit</button>
                                <button class="btn btn-delete" onclick="deleteStaff(${staff.id})">Delete</button>
                            </div>
                        `;
                        staffList.appendChild(staffItem);
                    });
                } else {
                    staffList.innerHTML = '<p>No staff members found.</p>';
                }
            } catch (error) {
                console.error('Error loading staff:', error);
                staffList.innerHTML = '<p>Failed to load staff members.</p>';
            }
        }

        // Open modal to add new staff
        addStaffBtn.addEventListener('click', () => {
            isUpdate = false;
            currentStaffId = null;
            staffUsername.value = '';
            staffEmail.value = '';
            staffPassword.value = '';
            modalTitle.textContent = 'Add Staff';
            staffModal.style.display = 'flex';
        });

        // Save staff (Add/Update)
        saveStaffBtn.addEventListener('click', async () => {
            const username = staffUsername.value;
            const email = staffEmail.value;
            const password = staffPassword.value;

            if (!username || !email || !password) {
                messageDiv.innerHTML = '<div class="error-message">All fields are required.</div>';
                return;
            }

            try {
                const method = isUpdate ? 'PUT' : 'POST';
                const url = isUpdate ? `http://localhost:5786/auth/updateStaff/${currentStaffId}` : 'http://localhost:5786/auth/addStaff';
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ username, email, password })
                });

                if (response.ok) {
                    messageDiv.innerHTML = '<div class="success-message">Staff saved successfully.</div>';
                    loadStaffs();
                    staffModal.style.display = 'none';
                } else {
                    messageDiv.innerHTML = '<div class="error-message">Failed to save staff.</div>';
                }
            } catch (error) {
                console.error('Error saving staff:', error);
                messageDiv.innerHTML = '<div class="error-message">Failed to save staff.</div>';
            }
        });

        // Edit staff
        function editStaff(id) {
            fetch(`http://localhost:5786/auth/getStaffById/${id}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(staff => {
                staffUsername.value = staff.username;
                staffEmail.value = staff.email;
                staffPassword.value = '';
                isUpdate = true;
                currentStaffId = staff.id;
                modalTitle.textContent = 'Update Staff';
                staffModal.style.display = 'flex';
            });
        }

        // Delete staff
        function deleteStaff(id) {
            fetch(`http://localhost:5786/auth/deleteStaff/${id}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (response.ok) {
                    messageDiv.innerHTML = '<div class="success-message">Staff deleted successfully.</div>';
                    loadStaffs();
                } else {
                    messageDiv.innerHTML = '<div class="error-message">Failed to delete staff.</div>';
                }
            })
            .catch(error => {
                console.error('Error deleting staff:', error);
                messageDiv.innerHTML = '<div class="error-message">Failed to delete staff.</div>';
            });
        }

        // Close modal on click outside
        window.addEventListener('click', (event) => {
            if (event.target === staffModal) {
                staffModal.style.display = 'none';
            }
        });

        // Load staff members on page load
        loadStaffs();
    </script>
</body>
</html>
